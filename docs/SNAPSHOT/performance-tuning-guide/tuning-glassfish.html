
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Tuning the GlassFish Server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
<table id="doc-title" cellspacing="0" cellpadding="0">
  <tr>
  <td align="left" valign="top">
  <b>Tuning the GlassFish Server</b><br />
  </td>
  </tr>
</table>
<hr />

<table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>
		<td align="left">
		<a href="tuning-apps.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="tuning-java.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>


<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a id="GSPTG00005"></a><a id="abedn"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tuning-the-glassfish-server">3 Tuning the GlassFish Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes some ways to tune your GlassFish Server
installation for optimum performance.</p>
</div>
<div class="paragraph">
<p>Note that while this chapter describes numerous interactions with both
the GlassFish Server Administration Console and the command-line
interface, it is not intended to provide exhaustive descriptions of
either. For complete information about using the Administration Console,
refer to the Administration Console online help. For complete
information about using the GlassFish Server command-line interface,
refer to the other titles in the GlassFish Server documentation set at
<code>http://docs.oracle.com/docs/cd/E18930_01/index.html</code>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gkxwm">Using the GlassFish Server Performance Tuner</a></p>
</li>
<li>
<p><a href="#abedo">Deployment Settings</a></p>
</li>
<li>
<p><a href="#abeds">Logger Settings</a></p>
</li>
<li>
<p><a href="#abedw">Web Container Settings</a></p>
</li>
<li>
<p><a href="#abeea">EJB Container Settings</a></p>
</li>
<li>
<p><a href="#abeel">Java Message Service Settings</a></p>
</li>
<li>
<p><a href="#abeem">Transaction Service Settings</a></p>
</li>
<li>
<p><a href="#abeet">HTTP Service Settings</a></p>
</li>
<li>
<p><a href="#abegk">Network Listener Settings</a></p>
</li>
<li>
<p><a href="#gkxjt">Transport Settings</a></p>
</li>
<li>
<p><a href="#abehk">Thread Pool Settings</a></p>
</li>
<li>
<p><a href="#abegt">ORB Settings</a></p>
</li>
<li>
<p><a href="#abehp">Resource Settings</a></p>
</li>
<li>
<p><a href="#gkxvd">Load Balancer Settings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gkxwm"></a><a id="GSPTG00055"></a><a id="using-the-glassfish-server-performance-tuner"></a></p>
</div>
<div class="sect2">
<h3 id="_using_the_glassfish_server_performance_tuner">Using the GlassFish Server Performance Tuner</h3>
<div class="paragraph">
<p>You can significantly improve the performance of GlassFish Server and
the applications deployed on it by adjusting a few deployment and server
configuration settings. These changes can be made manually, as described
in this chapter, or by using the built-in Performance Tuner in the
GlassFish Server Administration Console.</p>
</div>
<div class="paragraph">
<p>The Performance Tuner recommends server settings to suit the needs of
your GlassFish Server deployment. It helps you reach an optimal
configuration, although finer tuning might be needed in case of specific
requirements. You can configure performance tuning for the entire
domain, or for individual GlassFish Server instances or clusters. The
Tuner performs a static analysis of GlassFish Server resources and
throughput requirements. Note that no dynamic inspection of the system
is performed.</p>
</div>
<div class="paragraph">
<p>For complete information about using the Performance Tuning features
available through the GlassFish Server Administration Console, refer to
the Administration Console online help. You may also want to refer to
the following resources for additional information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To view a demonstration video showing how to use the GlassFish Server
Performance Tuner, see the
<a href="http://www.youtube.com/watch?v=FavsE2pzAjc">Oracle GlassFish Server 3.1 -
Performance Tuner demo</a> (<code>http://www.youtube.com/watch?v=FavsE2pzAjc</code>).</p>
</li>
<li>
<p>To find additional Performance Tuning development information, see the
<a href="http://blogs.oracle.com/jenblog/entry/performance_tuner_in_oracle_glassfish">Performance
Tuner in Oracle GlassFish Server 3.1</a>
(<code>http://blogs.oracle.com/jenblog/entry/performance_tuner_in_oracle_glassfish</code>)
blog.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abedo"></a><a id="GSPTG00056"></a><a id="deployment-settings"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_settings">Deployment Settings</h3>
<div class="paragraph">
<p>Deployment settings can have significant impact on performance. Follow
these guidelines when configuring deployment settings for best
performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abedp">Disable Auto-Deployment</a></p>
</li>
<li>
<p><a href="#abedq">Use Pre-compiled JavaServer Pages</a></p>
</li>
<li>
<p><a href="#abedr">Disable Dynamic Application Reloading</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abedp"></a><a id="GSPTG00180"></a><a id="disable-auto-deployment"></a></p>
</div>
<div class="sect3">
<h4 id="_disable_auto_deployment">Disable Auto-Deployment</h4>
<div class="paragraph">
<p>Enabling auto-deployment will adversely affect deployment, though it is
a convenience in a development environment. For a production system,
disable auto-deploy to optimize performance. If auto-deployment is
enabled, then the Reload Poll Interval setting can have a significant
performance impact.</p>
</div>
<div class="paragraph">
<p>To enable or disable auto-deployment from the GlassFish Server
Administration Console, navigate to the Domain node and then click the
Applications Configuration tab. Refer to the Administration Console for
further instructions. Alternatively, refer to "<a href="../application-deployment-guide/deploying-applications.html#GSDPG00041">To
Deploy an Application or Module Automatically</a>" in GlassFish Server Open
Source Edition Application Deployment Guide for instructions on enabling
or disabling auto-deployment.</p>
</div>
<div class="paragraph">
<p><a id="abedq"></a><a id="GSPTG00181"></a><a id="use-pre-compiled-javaserver-pages"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_use_pre_compiled_javaserver_pages">Use Pre-compiled JavaServer Pages</h4>
<div class="paragraph">
<p>Compiling JSP files is resource intensive and time consuming.
Pre-compiling JSP files before deploying applications on the server will
improve application performance. When you do so, only the resulting
servlet class files will be deployed.</p>
</div>
<div class="paragraph">
<p>You can specify to precompile JSP files when you deploy an application
through the Administration Console or <code>deploy</code> subcommand. You can also
specify to pre-compile JSP files for a deployed application with the
Administration Console. Navigate to the Domain node and then click the
Applications Configuration tab. Refer to the Administration Console for
further instructions.</p>
</div>
<div class="paragraph">
<p><a id="abedr"></a><a id="GSPTG00182"></a><a id="disable-dynamic-application-reloading"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_disable_dynamic_application_reloading">Disable Dynamic Application Reloading</h4>
<div class="paragraph">
<p>If dynamic reloading is enabled, the server periodically checks for
changes in deployed applications and automatically reloads the
application with the changes. Dynamic reloading is intended for
development environments and is also incompatible with session
persistence. To improve performance, disable dynamic class reloading.</p>
</div>
<div class="paragraph">
<p>You can use the Administration Console to disable dynamic class
reloading for an application that is already deployed. Navigate to the
Domain node and then click the Applications Configuration tab. Refer to
the Administration Console for further instructions.</p>
</div>
<div class="paragraph">
<p><a id="abeds"></a><a id="GSPTG00057"></a><a id="logger-settings"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logger_settings">Logger Settings</h3>
<div class="paragraph">
<p>The GlassFish Server produces writes log messages and exception stack
trace output to the log file in the logs directory of the instance,
domain-dir`/logs`. The volume of log activity can impact server
performance; particularly in benchmarking situations.</p>
</div>
<div class="paragraph">
<p><a id="abedt"></a><a id="GSPTG00183"></a><a id="general-settings"></a></p>
</div>
<div class="sect3">
<h4 id="_general_settings">General Settings</h4>
<div class="paragraph">
<p>In general, writing to the system log slows down performance slightly;
and increased disk access (increasing the log level, decreasing the file
rotation limit or time limit) also slows down the application.</p>
</div>
<div class="paragraph">
<p>Also, make sure that any custom log handler does not log to a slow
device like a network file system since this can adversely affect
performance.</p>
</div>
<div class="paragraph">
<p><a id="abedu"></a><a id="GSPTG00184"></a><a id="log-levels"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_log_levels">Log Levels</h4>
<div class="paragraph">
<p>Set the log level for the server and its subsystems in the GlassFish
Server Administration Console. Navigate to the
Configurations&gt;configuration-name&gt;Logger Settings page, and follow the
instructions in the online help. Alternatively, you can configure
logging by following the instructions in "<a href="../administration-guide/logging.html#GSADG00010">Administering
the Logging Service</a>" in GlassFish Server Open Source Edition
Administration Guide.</p>
</div>
<div class="paragraph">
<p><a id="abedw"></a><a id="GSPTG00058"></a><a id="web-container-settings"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_container_settings">Web Container Settings</h3>
<div class="paragraph">
<p>Set Web container settings in the GlassFish Server Administration
Console by navigating to the Configurations&gt;configuration-name&gt;Web
Container node. Follow the instructions in the online help for more
information. Alternatively, you can configure Web container settings by
following the instructions in "<a href="../administration-guide/webapps.html#GSADG00009">Administering Web
Applications</a>" in GlassFish Server Open Source Edition Administration
Guide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abedx">Session Properties: Session Timeout</a></p>
</li>
<li>
<p><a href="#abedy">Manager Properties: Reap Interval</a></p>
</li>
<li>
<p><a href="#abedz">Disable Dynamic JSP Reloading</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abedx"></a><a id="GSPTG00185"></a><a id="session-properties-session-timeout"></a></p>
</div>
<div class="sect3">
<h4 id="_session_properties_session_timeout">Session Properties: Session Timeout</h4>
<div class="paragraph">
<p>Session timeout determines how long the server maintains a session if a
user does not explicitly invalidate the session. The default value is 30
minutes. Tune this value according to your application requirements.
Setting a very large value for session timeout can degrade performance
by causing the server to maintain too many sessions in the session
store. However, setting a very small value can cause the server to
reclaim sessions too soon.</p>
</div>
<div class="paragraph">
<p><a id="abedy"></a><a id="GSPTG00186"></a><a id="manager-properties-reap-interval"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_manager_properties_reap_interval">Manager Properties: Reap Interval</h4>
<div class="paragraph">
<p>Modifying the reap interval can improve performance, but setting it
without considering the nature of your sessions and business logic can
cause data inconsistency, especially for time-based
persistence-frequency.</p>
</div>
<div class="paragraph">
<p>For example, if you set the reap interval to 60 seconds, the value of
session data will be recorded every 60 seconds. But if a client accesses
a servlet to update a value at 20 second increments, then
inconsistencies will result.</p>
</div>
<div class="paragraph">
<p>For example, consider the following online auction scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bidding starts at $5, in 60 seconds the value recorded will be $8
(three 20 second intervals).</p>
</li>
<li>
<p>During the next 40 seconds, the client starts incrementing the price.
The value the client sees is $10.</p>
</li>
<li>
<p>During the client&#8217;s 20 second rest, the GlassFish Server stops and
starts in 10 seconds. As a result, the latest value recorded at the 60
second interval ($8) is be loaded into the session.</p>
</li>
<li>
<p>The client clicks again expecting to see $11; but instead sees is $9,
which is incorrect.</p>
</li>
<li>
<p>So, to avoid data inconsistencies, take into the account the expected
behavior of the application when adjusting the reap interval.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abedz"></a><a id="GSPTG00187"></a><a id="disable-dynamic-jsp-reloading"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_disable_dynamic_jsp_reloading">Disable Dynamic JSP Reloading</h4>
<div class="paragraph">
<p>On a production system, improve web container performance by disabling
dynamic JSP reloading. To do so, edit the <code>default-web.xml</code> file in the
<code>config</code> directory for each instance. Change the servlet definition for
a JSP file to look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;servlet&gt;
  &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;development&lt;/param-name&gt;
    &lt;param-value&gt;false&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;xpoweredBy&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;genStrAsCharArray&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/init-param&gt;  &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
&lt;/servlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="abeea"></a><a id="GSPTG00059"></a><a id="ejb-container-settings"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejb_container_settings">EJB Container Settings</h3>
<div class="paragraph">
<p>The EJB Container has many settings that affect performance. As with
other areas, use monitor the EJB Container to track its execution and
performance.</p>
</div>
<div class="paragraph">
<p>You can configure most EJB container settings from the GlassFish Server
Administration Console by navigating to the
Configurations&gt;configuration-name&gt;EJB Container node and then following
the instructions in the online help.</p>
</div>
<div class="paragraph">
<p><a id="abeeb"></a><a id="GSPTG00188"></a><a id="monitoring-the-ejb-container"></a></p>
</div>
<div class="sect3">
<h4 id="_monitoring_the_ejb_container">Monitoring the EJB Container</h4>
<div class="paragraph">
<p>Monitoring the EJB container is disabled by default. You can enable EJB
monitoring through the GlassFish Server Administration Console by
navagating to the the Configurations&gt;configuration-name&gt;Monitoring node
and then following the instructions in the online help. Set the
monitoring level to LOW for to monitor all deployed EJB components, EJB
pools, and EJB caches. Set the monitoring level to HIGH to also monitor
EJB business methods.</p>
</div>
<div class="paragraph">
<p><a id="abeec"></a><a id="GSPTG00189"></a><a id="tuning-the-ejb-container"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_the_ejb_container">Tuning the EJB Container</h4>
<div class="paragraph">
<p>The EJB container caches and pools EJB components for better
performance. Tuning the cache and pool properties can provide
significant performance benefits to the EJB container.</p>
</div>
<div class="paragraph">
<p>The pool settings are valid for stateless session and entity beans while
the cache settings are valid for stateful session and entity beans.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeed">Overview of EJB Pooling and Caching</a></p>
</li>
<li>
<p><a href="#abeee">Tuning the EJB Pool</a></p>
</li>
<li>
<p><a href="#abeeg">Tuning the EJB Cache</a></p>
</li>
<li>
<p><a href="#abeei">Pool and Cache Settings for Individual EJB Components</a></p>
</li>
<li>
<p><a href="#abeej">Commit Option</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeed"></a><a id="GSPTG00117"></a><a id="overview-of-ejb-pooling-and-caching"></a></p>
</div>
<div class="sect4">
<h5 id="_overview_of_ejb_pooling_and_caching">Overview of EJB Pooling and Caching</h5>
<div class="paragraph">
<p>Both stateless session beans and entity beans can be pooled to improve
server performance. In addition, both stateful session beans and entity
beans can be cached to improve performance.</p>
</div>
<div class="paragraph">
<p><a id="sthref7"></a><a id="gacmo"></a></p>
</div>
<div class="paragraph">
<p>Table 3-1 Bean Type Pooling or Caching</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean Type</th>
<th class="tableblock halign-left valign-top">Pooled</th>
<th class="tableblock halign-left valign-top">Cached</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateless Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateful Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The difference between a pooled bean and a cached bean is that pooled
beans are all equivalent and indistinguishable from one another. Cached
beans, on the contrary, contain conversational state in the case of
stateful session beans, and are associated with a primary key in the
case of entity beans. Entity beans are removed from the pool and added
to the cache on <code>ejbActivate()</code> and removed from the cache and added to
the pool on <code>ejbPassivate()</code>. <code>ejbActivate()</code> is called by the container
when a needed entity bean is not in the cache. <code>ejbPassivate()</code> is
called by the container when the cache grows beyond its configured
limits.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>If you develop and deploy your EJB components using Oracle Java Studio,
then you need to edit the individual bean descriptor settings for bean
pool and bean cache. These settings might not be suitable for
production-level deployment.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="abeee"></a><a id="GSPTG00118"></a><a id="tuning-the-ejb-pool"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_tuning_the_ejb_pool">Tuning the EJB Pool</h5>
<div class="paragraph">
<p>A bean in the pool represents the pooled state in the EJB lifecycle.
This means that the bean does not have an identity. The advantage of
having beans in the pool is that the time to create a bean can be saved
for a request. The container has mechanisms that create pool objects in
the background, to save the time of bean creation on the request path.</p>
</div>
<div class="paragraph">
<p>Stateless session beans and entity beans use the EJB pool. Keeping in
mind how you use stateless session beans and the amount of traffic your
server handles, tune the pool size to prevent excessive creation and
deletion of beans.</p>
</div>
<div class="paragraph">
<p><a id="abeef"></a><a id="GSPTG00013"></a><a id="ejb-pool-settings"></a></p>
</div>
<div class="paragraph">
<p>EJB Pool Settings</p>
</div>
<div class="paragraph">
<p>An individual EJB component can specify cache settings that override
those of the EJB container in the <code>&lt;bean-pool&gt;</code> element of the EJB
component&#8217;s <code>sun-ejb-jar.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The EJB pool settings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initial and Minimum Pool Size: the initial and minimum number of beans
maintained in the pool. Valid values are from 0 to <code>MAX_INTEGER,</code> and
the default value is 8. The corresponding EJB deployment descriptor
attribute is <code>steady-pool-size.</code><br>
Set this property to a number greater than zero for a moderately loaded
system. Having a value greater than zero ensures that there is always a
pooled instance to process an incoming request.</p>
</li>
<li>
<p>Maximum Pool Size: the maximum number of connections that can be
created to satisfy client requests. Valid values are from zero to
<code>MAX_INTEGER</code>., and the default is 32. A value of zero means that the
size of the pool is unbounded. The potential implication is that the JVM
heap will be filled with objects in the pool. The corresponding EJB
deployment descriptor attribute is <code>max-pool-size</code>.<br>
Set this property to be representative of the anticipated high load of
the system. An very large pool wastes memory and can slow down the
system. A very small pool is also inefficient due to contention.</p>
</li>
<li>
<p>Pool Resize Quantity: the number of beans to be created or deleted
when the cache is being serviced by the server. Valid values are from
zero to <code>MAX_INTEGER</code> and default is 16. The corresponding EJB
deployment descriptor attribute is <code>resize-quantity</code>.<br>
Be sure to re-calibrate the pool resize quantity when you change the
maximum pool size, to maintain an equilibrium. Generally, a larger
maximum pool size should have a larger pool resize quantity.</p>
</li>
<li>
<p>Pool Idle Timeout: the maximum time that a stateless session bean,
entity bean, or message-driven bean is allowed to be idle in the pool.
After this time, the bean is destroyed if the bean in case is a
stateless session bean or a message driver bean. This is a hint to
server. The default value is 600 seconds. The corresponding EJB
deployment descriptor attribute is <code>pool-idle-timeout-in-seconds</code>.<br>
If there are more beans in the pool than the maximum pool size, the pool
drains back to initial and minimum pool size, in steps of pool resize
quantity at an interval specified by the pool idle timeout. If the
resize quantity is too small and the idle timeout large, you will not
see the pool draining back to steady size quickly enough.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeeg"></a><a id="GSPTG00119"></a><a id="tuning-the-ejb-cache"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_tuning_the_ejb_cache">Tuning the EJB Cache</h5>
<div class="paragraph">
<p>A bean in the cache represents the ready state in the EJB lifecycle.
This means that the bean has an identity (for example, a primary key or
session ID) associated with it.</p>
</div>
<div class="paragraph">
<p>Beans moving out of the cache have to be passivated or destroyed
according to the EJB lifecycle. Once passivated, a bean has to be
activated to come back into the cache. Entity beans are generally stored
in databases and use some form of query language semantics to load and
store data. Session beans have to be serialized when storing them upon
passivation onto the disk or a database; and similarly have to be
deserialized upon activation.</p>
</div>
<div class="paragraph">
<p>Any incoming request using these "ready" beans from the cache avoids the
overhead of creation, setting identity, and potentially activation. So,
theoretically, it is good to cache as many beans as possible. However,
there are drawbacks to caching:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Memory consumed by all the beans affects the heap available in the
Virtual Machine.</p>
</li>
<li>
<p>Increasing objects and memory taken by cache means longer, and
possibly more frequent, garbage collection.</p>
</li>
<li>
<p>The application server might run out of memory unless the heap is
carefully tuned for peak loads.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keeping in mind how your application uses stateful session beans and
entity beans, and the amount of traffic your server handles, tune the
EJB cache size and timeout settings to minimize the number of
activations and passivations.</p>
</div>
<div class="paragraph">
<p><a id="abeeh"></a><a id="GSPTG00014"></a><a id="ejb-cache-settings"></a></p>
</div>
<div class="paragraph">
<p>EJB Cache Settings</p>
</div>
<div class="paragraph">
<p>An individual EJB component can specify cache settings that override
those of the EJB container in the <code>&lt;bean-cache&gt;</code> element of the EJB
component&#8217;s <code>sun-ejb-jar.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The EJB cache settings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Max Cache Size: Maximum number of beans in the cache. Make this
setting greater than one. The default value is 512. A value of zero
indicates the cache is unbounded, which means the size of the cache is
governed by Cache Idle Timeout and Cache Resize Quantity. The
corresponding EJB deployment descriptor attribute is <code>max-cache-size</code>.</p>
</li>
<li>
<p>Cache Resize Quantity: Number of beans to be created or deleted when
the cache is serviced by the server. Valid values are from zero to
MAX_INTEGER, and the default is 16. The corresponding EJB deployment
descriptor attribute is <code>resize-quantity</code>.</p>
</li>
<li>
<p>Removal Timeout: Amount of time that a stateful session bean remains
passivated (idle in the backup store). If a bean was not accessed after
this interval of time, then it is removed from the backup store and will
not be accessible to the client. The default value is 60 minutes. The
corresponding EJB deployment descriptor attribute is
<code>removal-timeout-in-seconds</code>.</p>
</li>
<li>
<p>Removal Selection Policy: Algorithm used to remove objects from the
cache. The corresponding EJB deployment descriptor attribute is
<code>victim-selection-policy</code>. Choices are:</p>
<div class="ulist">
<ul>
<li>
<p>NRU (not recently used). This is the default, and is actually
pseudo-random selection policy.</p>
</li>
<li>
<p>FIFO (first in, first out)</p>
</li>
<li>
<p>LRU (least recently used)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cache Idle Timeout: Maximum time that a stateful session bean or
entity bean is allowed to be idle in the cache. After this time, the
bean is passivated to the backup store. The default value is 600
seconds. The corresponding EJB deployment descriptor attribute is
<code>cache-idle-timeout-in-seconds</code>.</p>
</li>
<li>
<p>Refresh period: Rate at which a read-only-bean is refreshed from the
data source. Zero (0) means that the bean is never refreshed. The
default is 600 seconds. The corresponding EJB deployment descriptor
attribute is <code>refresh-period-in-seconds</code>. Note: this setting does not
have a custom field in the Admin Console. To set it, use the Add
Property button in the Additional Properties section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeei"></a><a id="GSPTG00120"></a><a id="pool-and-cache-settings-for-individual-ejb-components"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_pool_and_cache_settings_for_individual_ejb_components">Pool and Cache Settings for Individual EJB Components</h5>
<div class="paragraph">
<p>Individual EJB pool and cache settings in the <code>sun-ejb-jar.xml</code>
deployment descriptor override those of the EJB container. The following
table lists the cache and pool settings for each type of EJB component.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 35%;">
<col style="width: 13%;">
<col style="width: 13%;">
<col style="width: 13%;">
<col style="width: 13%;">
<col style="width: 13%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cache or Pool Setting</th>
<th class="tableblock halign-left valign-top">Stateful Session Bean</th>
<th class="tableblock halign-left valign-top">Stateless Session Bean</th>
<th class="tableblock halign-left valign-top">Entity Bean</th>
<th class="tableblock halign-left valign-top">Entity Read-Only Bean</th>
<th class="tableblock halign-left valign-top">Message Driven Bean</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache-resize-quantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-cache-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache-idle-timeout-in-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removal-timeout-in-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>victim-selection-policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>refresh-period-in-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>steady-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool-resize-quantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool-idle-timeout-in-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="abeej"></a><a id="GSPTG00121"></a><a id="commit-option"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_commit_option">Commit Option</h5>
<div class="paragraph">
<p>The commit option controls the action taken by the EJB container when an
EJB component completes a transaction. The commit option has a
significant impact on performance.</p>
</div>
<div class="paragraph">
<p>The following are the possible values for the commit option:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Commit option B: When a transaction completes, the bean is kept in the
cache and retains its identity. The next invocation for the same primary
key can use the cached instance. The EJB container will call the bean&#8217;s
<code>ejbLoad()</code> method before the method invocation to synchronize with the
database.</p>
</li>
<li>
<p>Commit option C: When a transaction completes, the EJB container calls
the bean&#8217;s <code>ejbPassivate()</code> method, the bean is disassociated from its
primary key and returned to the free pool. The next invocation for the
same primary key will have to get a free bean from the pool, set the
<code>PrimaryKey</code> on this instance, and then call <code>ejbActivate()</code> on the
instance. Again, the EJB container will call the bean&#8217;s <code>ejbLoad()</code>
before the method invocation to synchronize with the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Option B avoids <code>ejbAcivate()</code> and <code>ejbPassivate()</code> calls. So, in most
cases it performs better than option C since it avoids some overhead in
acquiring and releasing objects back to pool.</p>
</div>
<div class="paragraph">
<p>However, there are some cases where option C can provide better
performance. If the beans in the cache are rarely reused and if beans
are constantly added to the cache, then it makes no sense to cache
beans. With option C is used, the container puts beans back into the
pool (instead of caching them) after method invocation or on transaction
completion. This option reuses instances better and reduces the number
of live objects in the JVM, speeding garbage collection.</p>
</div>
<div class="paragraph">
<p><a id="abeek"></a><a id="GSPTG00015"></a><a id="determining-the-best-commit-option"></a></p>
</div>
<div class="paragraph">
<p>Determining the Best Commit Option</p>
</div>
<div class="paragraph">
<p>To determine whether to use commit option B or commit option C, first
take a look at the cache-hits value using the monitoring command for the
bean. If the cache hits are much higher than cache misses, then option B
is an appropriate choice. You might still have to change the
<code>max-cache-size</code> and <code>cache-resize-quantity</code> to get the best result.</p>
</div>
<div class="paragraph">
<p>If the cache hits are too low and cache misses are very high, then the
application is not reusing the bean instances and hence increasing the
cache size (using <code>max-cache-size</code>) will not help (assuming that the
access pattern remains the same). In this case you might use commit
option C. If there is no great difference between cache-hits and
cache-misses then tune <code>max-cache-size</code>, and probably
<code>cache-idle-timeout-in-seconds</code>.</p>
</div>
<div class="paragraph">
<p><a id="abeel"></a><a id="GSPTG00060"></a><a id="java-message-service-settings"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_message_service_settings">Java Message Service Settings</h3>
<div class="paragraph">
<p>The Type attribute that determines whether the Java Message Service
(JMS) is on local or remote system affects performance. Local JMS
performance is better than remote JMS performance. However, a remote
cluster can provide failover capabilities and can be administrated
together, so there may be other advantages of using remote JMS. For more
information on using JMS, see "<a href="../administration-guide/jms.html#GSADG00020">Administering the Java
Message Service (JMS)</a>" in GlassFish Server Open Source Edition
Administration Guide.</p>
</div>
<div class="paragraph">
<p><a id="abeem"></a><a id="GSPTG00061"></a><a id="transaction-service-settings"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_transaction_service_settings">Transaction Service Settings</h3>
<div class="paragraph">
<p>The transaction manager makes it possible to commit and roll back
distributed transactions.</p>
</div>
<div class="paragraph">
<p>A distributed transactional system writes transactional activity into
transaction logs so that they can be recovered later. But writing
transactional logs has some performance penalty.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeen">Monitoring the Transaction Service</a></p>
</li>
<li>
<p><a href="#abeep">Tuning the Transaction Service</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeen"></a><a id="GSPTG00190"></a><a id="monitoring-the-transaction-service"></a></p>
</div>
<div class="sect3">
<h4 id="_monitoring_the_transaction_service">Monitoring the Transaction Service</h4>
<div class="paragraph">
<p>Transaction Manager monitoring is disabled by default. Enable monitoring
of the transaction service through the GlassFish Server Administration
Console by navigating to the
Configurations&gt;configuration-name&gt;Monitoring node. Refer to the
Administration Console for complete instructions.</p>
</div>
<div class="paragraph">
<p>You can also enable monitoring with these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">set serverInstance.transaction-service.monitoringEnabled=true
reconfig serverInstance</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="abeeo"></a><a id="GSPTG00122"></a><a id="viewing-monitoring-information"></a></p>
</div>
<div class="sect4">
<h5 id="_viewing_monitoring_information">Viewing Monitoring Information</h5>
<div class="paragraph">
<p>To view monitoring information for the transaction service in the
GlassFish Server Administration Console, navigate to the server (Admin
Server) node and then select the Monitor tab.</p>
</div>
<div class="paragraph">
<p>The following statistics are gathered on the transaction service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>total-tx-completed</code> Completed transactions.</p>
</li>
<li>
<p><code>total-tx-rolled-back</code> Total rolled back transactions.</p>
</li>
<li>
<p><code>total-tx-inflight</code> Total inflight (active) transactions.</p>
</li>
<li>
<p><code>isFrozen</code> Whether transaction system is frozen (true or false)</p>
</li>
<li>
<p><code>inflight-tx</code> List of inflight (active) transactions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeep"></a><a id="GSPTG00191"></a><a id="tuning-the-transaction-service"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_the_transaction_service">Tuning the Transaction Service</h4>
<div class="paragraph">
<p>This property can be used to disable the transaction logging, where the
performance is of utmost importance more than the recovery. This
property, by default, won&#8217;t exist in the server configuration.</p>
</div>
<div class="paragraph">
<p>Most Transaction Service tuning tasks can be performed through the
GlassFish Server Administration Console by navigating to the
Configurations&gt;configuration-name&gt;Transaction Service node and then
following the instructions in the online help. Alternatively, you can
follow the instructions in "<a href="../administration-guide/transactions.html#GSADG00022">Administering
Transactions</a>" in GlassFish Server Open Source Edition Administration
Guide.</p>
</div>
<div class="paragraph">
<p><a id="abeeq"></a><a id="GSPTG00123"></a><a id="disable-distributed-transaction-logging"></a></p>
</div>
<div class="sect4">
<h5 id="_disable_distributed_transaction_logging">Disable Distributed Transaction Logging</h5>
<div class="paragraph">
<p>You can disable transaction logging through the Administration Console
or by using the following <code>asadmin set</code> subcommand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin set
server1.transaction-service.disable-distributed-transaction-logging=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disabling transaction logging can improve performance. Setting it to
false (the default), makes the transaction service write transactional
activity to transaction logs so that transactions can be recovered. If
Recover on Restart is checked, this property is ignored.</p>
</div>
<div class="paragraph">
<p>Set this property to true only if performance is more important than
transaction recovery.</p>
</div>
<div class="paragraph">
<p><a id="abeer"></a><a id="GSPTG00124"></a><a id="recover-on-restart-automatic-recovery"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_recover_on_restart_automatic_recovery">Recover On Restart (Automatic Recovery)</h5>
<div class="paragraph">
<p>You can set the Recover on Restart attribute through the Administration
Console or by entering the following <code>asadmin set</code> subcommand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin set server1.transaction-service.automatic-recovery=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>When Recover on Restart is true, the server will always perform
transaction logging, regardless of the Disable Distributed Transaction
Logging attribute.</p>
</div>
<div class="paragraph">
<p>If Recover on Restart is false, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Disable Distributed Transaction Logging is false (the default),
then the server will write transaction logs.</p>
</li>
<li>
<p>If Disable Distributed Transaction Logging is true, then the server
will not write transaction logs.<br>
Not writing transaction logs will give approximately twenty percent
improvement in performance, but at the cost of not being able to recover
from any interrupted transactions. The performance benefit applies to
transaction-intensive tests. Gains in real applications may be less.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abees"></a><a id="GSPTG00125"></a><a id="keypoint-interval"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_keypoint_interval">Keypoint Interval</h5>
<div class="paragraph">
<p>The keypoint interval determines how often entries for completed
transactions are removed from the log file. Keypointing prevents a
process log from growing indefinitely.</p>
</div>
<div class="paragraph">
<p>Frequent keypointing is detrimental to performance. The default value of
the Keypoint Interval is 2048, which is sufficient in most cases.</p>
</div>
<div class="paragraph">
<p><a id="abeet"></a><a id="GSPTG00062"></a><a id="http-service-settings"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_service_settings">HTTP Service Settings</h3>
<div class="paragraph">
<p>Tuning the monitoring and access logging settings for the HTTP server
instances that handle client requests are important parts of ensuring
peak GlassFish Server performance.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeeu">Monitoring the HTTP Service</a></p>
</li>
<li>
<p><a href="#abefk">HTTP Service Access Logging</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeeu"></a><a id="GSPTG00192"></a><a id="monitoring-the-http-service"></a></p>
</div>
<div class="sect3">
<h4 id="_monitoring_the_http_service">Monitoring the HTTP Service</h4>
<div class="paragraph">
<p>Disabling the collection of monitoring statistics can increase overall
GlassFish Server performance. You can enable or disable monitoring
statistics collection for the HTTP service using either the
Administration Console or <code>asadmin</code> subcommands.</p>
</div>
<div class="paragraph">
<p>Refer to "<a href="../administration-guide/monitoring.html#GSADG00011">Administering the Monitoring Service</a>" in
GlassFish Server Open Source Edition Administration Guide for complete
instructions on configuring the monitoring service using <code>asadmin</code>
subcommands.</p>
</div>
<div class="paragraph">
<p>If using the Administration Console, click the
Configurations&gt;configuration-name&gt;Monitoring node for the configuration
for which you want to enable or disable monitoring for selected
components. Refer to the Administration Console online help for complete
instructions.</p>
</div>
<div class="paragraph">
<p>For instructions on viewing comprehensive monitoring statistics using
<code>asadmin</code> subcommands, see "<a href="../administration-guide/monitoring.html#GSADG00560">Viewing Comprehensive
Monitoring Data</a>" in GlassFish Server Open Source Edition Administration
Guide. If using the Administration Console, you can view monitoring
statistics by navigating to the server (Admin Server) node, and then
clicking the Monitor tab. Refer to the online help for configuring
different views of the available monitoring statistics.</p>
</div>
<div class="paragraph">
<p>When viewing monitoring statistics, some key performance-related
information to review includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeew">DNS Cache Information (dns)</a></p>
</li>
<li>
<p><a href="#abefh">File Cache Information (file-cache)</a></p>
</li>
<li>
<p><a href="#abefi">Keep Alive (keep-alive)</a></p>
</li>
<li>
<p><a href="#abefg">Connection Queue</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeew"></a><a id="GSPTG00126"></a><a id="dns-cache-information-dns"></a></p>
</div>
<div class="sect4">
<h5 id="_dns_cache_information_dns">DNS Cache Information (dns)</h5>
<div class="paragraph">
<p>The DNS cache caches IP addresses and DNS names. The DNS cache is
disabled by default. In the DNS Statistics for Process ID All page under
Monitor in the web-based Administration interface the following
statistics are displayed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeex">Enabled</a></p>
</li>
<li>
<p><a href="#abeey">CacheEntries (CurrentCacheEntries / MaxCacheEntries)</a></p>
</li>
<li>
<p><a href="#abeez">HitRatio</a></p>
</li>
<li>
<p><a href="#abefa">Caching DNS Entries</a></p>
</li>
<li>
<p><a href="#abefb">Limit DNS Lookups to Asynchronous</a></p>
</li>
<li>
<p><a href="#abefc">Enabled</a></p>
</li>
<li>
<p><a href="#abefd">NameLookups</a></p>
</li>
<li>
<p><a href="#abefe">AddrLookups</a></p>
</li>
<li>
<p><a href="#abeff">LookupsInProgress</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeex"></a><a id="GSPTG00016"></a><a id="enabled"></a></p>
</div>
<div class="paragraph">
<p>Enabled</p>
</div>
<div class="paragraph">
<p>If the DNS cache is disabled, the rest of this section is not displayed.</p>
</div>
<div class="paragraph">
<p>By default, the DNS cache is off. Enable DNS caching in the
Administration Console by clicking the
Configurations&gt;configuration-name&gt;Network Config&gt;http-listener-name
node. Click the HTTP tab and enable the DNS Lookup option.</p>
</div>
<div class="paragraph">
<p><a id="abeey"></a><a id="GSPTG00017"></a><a id="cacheentries-currentcacheentries-maxcacheentries"></a></p>
</div>
<div class="paragraph">
<p>CacheEntries (CurrentCacheEntries / MaxCacheEntries)</p>
</div>
<div class="paragraph">
<p>The number of current cache entries and the maximum number of cache
entries. A single cache entry represents a single IP address or DNS name
lookup. Make the cache as large as the maximum number of clients that
access your web site concurrently. Note that setting the cache size too
high is a waste of memory and degrades performance.</p>
</div>
<div class="paragraph">
<p>Set the maximum size of the DNS cache by entering or changing the value
in the in the Administration Console by clicking the
Configurations&gt;configuration-name&gt;Network Config&gt;http-listener-name
node. Click the File tab and set the desired options.</p>
</div>
<div class="paragraph">
<p><a id="abeez"></a><a id="GSPTG00018"></a><a id="hitratio"></a></p>
</div>
<div class="paragraph">
<p>HitRatio</p>
</div>
<div class="paragraph">
<p>The hit ratio is the number of cache hits divided by the number of cache
lookups.</p>
</div>
<div class="paragraph">
<p>This setting is not tunable.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>If you turn off DNS lookups on your server, host name restrictions will
not work and IP addresses will appear instead of host names in log
files.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="abefa"></a><a id="GSPTG00019"></a><a id="caching-dns-entries"></a></p>
</div>
<div class="paragraph">
<p>Caching DNS Entries</p>
</div>
<div class="paragraph">
<p>It is possible to also specify whether to cache the DNS entries. If you
enable the DNS cache, the server can store hostname information after
receiving it. If the server needs information about the client in the
future, the information is cached and available without further
querying. specify the size of the DNS cache and an expiration time for
DNS cache entries. The DNS cache can contain 32 to 32768 entries; the
default value is 1024. Values for the time it takes for a cache entry to
expire can range from 1 second to 1 year specified in seconds; the
default value is 1200 seconds (20 minutes).</p>
</div>
<div class="paragraph">
<p><a id="abefb"></a><a id="GSPTG00020"></a><a id="limit-dns-lookups-to-asynchronous"></a></p>
</div>
<div class="paragraph">
<p>Limit DNS Lookups to Asynchronous</p>
</div>
<div class="paragraph">
<p>Do not use DNS lookups in server processes because they are
resource-intensive. If you must include DNS lookups, make them
asynchronous.</p>
</div>
<div class="paragraph">
<p><a id="abefc"></a><a id="GSPTG00021"></a><a id="enabled-1"></a></p>
</div>
<div class="paragraph">
<p>Enabled</p>
</div>
<div class="paragraph">
<p>If asynchronous DNS is disabled, the rest of this section will not be
displayed.</p>
</div>
<div class="paragraph">
<p><a id="abefd"></a><a id="GSPTG00022"></a><a id="namelookups"></a></p>
</div>
<div class="paragraph">
<p>NameLookups</p>
</div>
<div class="paragraph">
<p>The number of name lookups (DNS name to IP address) that have been done
since the server was started. This setting is not tunable.</p>
</div>
<div class="paragraph">
<p><a id="abefe"></a><a id="GSPTG00023"></a><a id="addrlookups"></a></p>
</div>
<div class="paragraph">
<p>AddrLookups</p>
</div>
<div class="paragraph">
<p>The number of address loops (IP address to DNS name) that have been done
since the server was started. This setting is not tunable.</p>
</div>
<div class="paragraph">
<p><a id="abeff"></a><a id="GSPTG00024"></a><a id="lookupsinprogress"></a></p>
</div>
<div class="paragraph">
<p>LookupsInProgress</p>
</div>
<div class="paragraph">
<p>The current number of lookups in progress.</p>
</div>
<div class="paragraph">
<p><a id="abefh"></a><a id="GSPTG00127"></a><a id="file-cache-information-file-cache"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_file_cache_information_file_cache">File Cache Information (file-cache)</h5>
<div class="paragraph">
<p>The file cache caches static content so that the server handles requests
for static content quickly. The file-cache section provides statistics
on how your file cache is being used.</p>
</div>
<div class="paragraph">
<p>For information about tuning the file cache, see <a href="#gkxit">File Cache
Settings</a>.</p>
</div>
<div class="paragraph">
<p>The Monitoring page lists the following file cache statistics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of Hits on Cached File Content</p>
</li>
<li>
<p>Number of Cache Entries</p>
</li>
<li>
<p>Number of Hits on Cached File Info</p>
</li>
<li>
<p>Heap Space Used for Cache</p>
</li>
<li>
<p>Number of Misses on Cached File Content</p>
</li>
<li>
<p>Cache Lookup Misses</p>
</li>
<li>
<p>Number of Misses on Cached File Content</p>
</li>
<li>
<p>Max Age of a Cache Entry</p>
</li>
<li>
<p>Max Number of Cache Entries</p>
</li>
<li>
<p>Max Number of Open Entries</p>
</li>
<li>
<p>Is File Cached Enabled?</p>
</li>
<li>
<p>Maximum Memory Map to be Used for Cache</p>
</li>
<li>
<p>Memory Map Used for cache</p>
</li>
<li>
<p>Cache Lookup Hits</p>
</li>
<li>
<p>Open Cache Entries: The number of current cache entries and the
maximum number of cache entries are both displayed. A single cache entry
represents a single URI. This is a tunable setting.</p>
</li>
<li>
<p>Maximum Heap Space to be Used for Cache</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abefi"></a><a id="GSPTG00128"></a><a id="keep-alive-keep-alive"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_keep_alive_keep_alive">Keep Alive (keep-alive)</h5>
<div class="paragraph">
<p>The following are statistics related to the Keep Alive system. The most
important settings you can tune here relate to HTTP Timeout. See
<a href="#abefu">Timeout</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connections Terminated Due to Client Connection Timed Out</p>
</li>
<li>
<p>Max Connection Allowed in Keep-alive</p>
</li>
<li>
<p>Number of Hits</p>
</li>
<li>
<p>Connections in Keep-alive Mode</p>
</li>
<li>
<p>Connections not Handed to Keep-alive Thread Due to too Many Persistent
Connections</p>
</li>
<li>
<p>The Time in Seconds Before Idle Connections are Closed</p>
</li>
<li>
<p>Connections Closed Due to Max Keep-alive Being Exceeded</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abefg"></a><a id="GSPTG00129"></a><a id="connection-queue"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_connection_queue">Connection Queue</h5>
<div class="ulist">
<ul>
<li>
<p>Total Connections Queued: Total connections queued is the total number
of times a connection has been queued. This includes newly accepted
connections and connections from the keep-alive system.</p>
</li>
<li>
<p>Average Queuing Delay: Average queueing delay is the average amount of
time a connection spends in the connection queue. This represents the
delay between when a request connection is accepted by the server, and a
request processing thread (also known as a session) begins servicing the
request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abefk"></a><a id="GSPTG00193"></a><a id="http-service-access-logging"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_service_access_logging">HTTP Service Access Logging</h4>
<div class="paragraph">
<p>Accessing Logging can be tuned using several <code>asadmin</code> subcommands.
Refer to "<a href="../administration-guide/monitoring.html#GSADG00011">Administering the Monitoring Service</a>" in
GlassFish Server Open Source Edition Administration Guide for
information about using these subcommands.</p>
</div>
<div class="paragraph">
<p>If using the Administration Console, Access Logging is configured from
the Configurations&gt;configuration-name&gt;HTTP Service page. Refer to the
Administration Console online help for complete instructions about the
options on this page.</p>
</div>
<div class="paragraph">
<p>To enable or disable access logging, check or uncheck the Access Logging
Enabled checkbox. Access Logging is disabled by default.</p>
</div>
<div class="paragraph">
<p>When performing benchmarking, ensure that Access Logging is disabled. If
Access Logging is enabled, it is recommended that you also enable
Rotation to ensure that the logs do not run out of disk space.</p>
</div>
<div class="paragraph">
<p><a id="abegk"></a><a id="GSPTG00063"></a><a id="network-listener-settings"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_network_listener_settings">Network Listener Settings</h3>
<div class="paragraph">
<p>You can tune Network Listener settings from the command line by using
the instructions in "<a href="../administration-guide/http_https.html#GSADG00588">Administering HTTP Network
Listeners</a>" in GlassFish Server Open Source Edition Administration
Guide.</p>
</div>
<div class="paragraph">
<p>If using the Administration Console, navigate to the Configurations
&gt;configuration-name&gt;Network Config&gt;Network Listeners&gt;listener-name node,
and then click the tab for the desired configuration page. Refer to the
online help for complete instructions about the options on these tabs.</p>
</div>
<div class="paragraph">
<p>GlassFish Server Network Listener performance can be enhanced by
modifying settings on the following Edit Network Listener tabs in the
Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abegl">General Settings</a></p>
</li>
<li>
<p><a href="#gkxjd">HTTP Settings</a></p>
</li>
<li>
<p><a href="#gkxit">File Cache Settings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abegl"></a><a id="GSPTG00194"></a><a id="general-settings-1"></a></p>
</div>
<div class="sect3">
<h4 id="_general_settings_2">General Settings</h4>
<div class="paragraph">
<p>For machines with only one network interface card (NIC), set the network
address to the IP address of the machine (for example, 192.18.80.23
instead of default 0.0.0.0). If you specify an IP address other than
0.0.0.0, the server will make one less system call per connection.
Specify an IP address other than 0.0.0.0 for best possible performance.
If the server has multiple NIC cards then create multiple listeners for
each NIC.</p>
</div>
<div class="paragraph">
<p><a id="gkxjd"></a><a id="GSPTG00195"></a><a id="http-settings"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_http_settings">HTTP Settings</h4>
<div class="paragraph">
<p>The following settings on the HTTP tab can significantly affect
performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeft">Max Connections</a></p>
</li>
<li>
<p><a href="#abegd">DNS Lookup Enabled</a></p>
</li>
<li>
<p><a href="#abefu">Timeout</a></p>
</li>
<li>
<p><a href="#abefq">Header Buffer Length</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeft"></a><a id="GSPTG00130"></a><a id="max-connections"></a></p>
</div>
<div class="sect4">
<h5 id="_max_connections">Max Connections</h5>
<div class="paragraph">
<p>Max Connections controls the number of requests that a particular client
can make over a keep-alive connection. The range is any positive
integer, and the default is 256.</p>
</div>
<div class="paragraph">
<p>Adjust this value based on the number of requests a typical client makes
in your application. For best performance specify quite a large number,
allowing clients to make many requests.</p>
</div>
<div class="paragraph">
<p>The number of connections specified by Max Connections is divided
equally among the keep alive threads. If Max Connections is not equally
divisible by Thread Count, the server can allow slightly more than Max
Connections simultaneous keep alive connections.</p>
</div>
<div class="paragraph">
<p><a id="abegd"></a><a id="GSPTG00131"></a><a id="dns-lookup-enabled"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_dns_lookup_enabled">DNS Lookup Enabled</h5>
<div class="paragraph">
<p>This setting specifies whether the server performs DNS (domain name
service) lookups on clients that access the server. When DNS lookup is
not enabled, when a client connects, the server knows the client&#8217;s IP
address but not its host name (for example, it knows the client as
198.95.251.30, rather than <code>www.xyz.com</code>). When DNS lookup is enabled,
the server will resolve the client&#8217;s IP address into a host name for
operations like access control, common gateway interface (CGI) programs,
error reporting, and access logging.</p>
</div>
<div class="paragraph">
<p>If the server responds to many requests per day, reduce the load on the
DNS or NIS (Network Information System) server by disabling DNS lookup.
Enabling DNS lookup will increase the latency and load on the system, so
modify this setting with caution.</p>
</div>
<div class="paragraph">
<p><a id="abefu"></a><a id="GSPTG00132"></a><a id="timeout"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_timeout">Timeout</h5>
<div class="paragraph">
<p>Timeout determines the maximum time (in seconds) that the server holds
open an HTTP keep alive connection. A client can keep a connection to
the server open so that multiple requests to one server can be serviced
by a single network connection. Since the number of open connections
that the server can handle is limited, a high number of open connections
will prevent new clients from connecting.</p>
</div>
<div class="paragraph">
<p>The default time out value is 30 seconds. Thus, by default, the server
will close the connection if idle for more than 30 seconds. The maximum
value for this parameter is 300 seconds (5 minutes).</p>
</div>
<div class="paragraph">
<p>The proper value for this parameter depends upon how much time is
expected to elapse between requests from a given client. For example, if
clients are expected to make requests frequently then, set the parameter
to a high value; likewise, if clients are expected to make requests
rarely, then set it to a low value.</p>
</div>
<div class="paragraph">
<p>Both HTTP 1.0 and HTTP 1.1 support the ability to send multiple requests
across a single HTTP session. A server can receive hundreds of new HTTP
requests per second. If every request was allowed to keep the connection
open indefinitely, the server could become overloaded with connections.
On Unix/Linux systems, this could easily lead to a file table overflow.</p>
</div>
<div class="paragraph">
<p>The GlassFish Server&#8217;s Keep Alive system, which is affected by the
Timeout setting, addresses this problem. A waiting keep alive connection
has completed processing the previous request, and is waiting for a new
request to arrive on the same connection. The server maintains a counter
for the maximum number of waiting keep-alive connections. If the server
has more than the maximum waiting connections open when a new connection
waits for a keep-alive request, the server closes the oldest connection.
This algorithm limits the number of open waiting keep-alive connections.</p>
</div>
<div class="paragraph">
<p>If your system has extra CPU cycles, incrementally increase the keep
alive settings and monitor performance after each increase. When
performance saturates (stops improving), then stop increasing the
settings.</p>
</div>
<div class="paragraph">
<p><a id="abefq"></a><a id="GSPTG00133"></a><a id="header-buffer-length"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_header_buffer_length">Header Buffer Length</h5>
<div class="paragraph">
<p>The size (in bytes) of the buffer used by each of the request processing
threads for reading the request data from the client.</p>
</div>
<div class="paragraph">
<p>Adjust the value based on the actual request size and observe the impact
on performance. In most cases the default should suffice. If the request
size is large, increase this parameter.</p>
</div>
<div class="paragraph">
<p><a id="gkxit"></a><a id="GSPTG00196"></a><a id="file-cache-settings"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_file_cache_settings">File Cache Settings</h4>
<div class="paragraph">
<p>The GlassFish Server uses a file cache to serve static information
faster. The file cache contains information about static files such as
HTML, CSS, image, or text files. Enabling the HTTP file cache will
improve performance of applications that contain static files.</p>
</div>
<div class="paragraph">
<p>The following settings on the File Cache tab can significantly affect
performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abegf">Max File Count</a></p>
</li>
<li>
<p><a href="#abegh">Max Age</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abegf"></a><a id="GSPTG00134"></a><a id="max-file-count"></a></p>
</div>
<div class="sect4">
<h5 id="_max_file_count">Max File Count</h5>
<div class="paragraph">
<p>Max File Count determines how many files are in the cache. If the value
is too big, the server caches little-needed files, which wastes memory.
If the value is too small, the benefit of caching is lost. Try different
values of this attribute to find the optimal solution for specific
applications—generally, the effects will not be great.</p>
</div>
<div class="paragraph">
<p><a id="abegh"></a><a id="GSPTG00135"></a><a id="max-age"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_max_age">Max Age</h5>
<div class="paragraph">
<p>This parameter controls how long cached information is used after a file
has been cached. An entry older than the maximum age is replaced by a
new entry for the same file.</p>
</div>
<div class="paragraph">
<p>If your Web site&#8217;s content changes infrequently, increase this value for
improved performance. Set the maximum age by entering or changing the
value in the Maximum Age field of the File Cache Configuration page in
the web-based Admin Console for the HTTP server node and selecting the
File Caching Tab.</p>
</div>
<div class="paragraph">
<p>Set the maximum age based on whether the content is updated (existing
files are modified) on a regular schedule or not. For example, if
content is updated four times a day at regular intervals, you could set
the maximum age to 21600 seconds (6 hours). Otherwise, consider setting
the maximum age to the longest time you are willing to serve the
previous version of a content file after the file has been modified.</p>
</div>
<div class="paragraph">
<p><a id="gkxjt"></a><a id="GSPTG00064"></a><a id="transport-settings"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transport_settings">Transport Settings</h3>
<div class="paragraph">
<p>The Acceptor Threads property for the Transport service specifies how
many threads you want in accept mode on a listen socket at any time. It
is a good practice to set this to less than or equal to the number of
CPUs in your system.</p>
</div>
<div class="paragraph">
<p>In the GlassFish Server, acceptor threads on an HTTP Listener accept
connections and put them onto a connection queue. Session threads then
pick up connections from the queue and service the requests. The server
posts more session threads if required at the end of the request.</p>
</div>
<div class="paragraph">
<p>See "<a href="../administration-guide/http_https.html#GSADG00771">Administering HTTP Network Listeners</a>" in
GlassFish Server Open Source Edition Administration Guide for
instructions on modifying the Acceptor Threads property. If using the
Administration Console, the Acceptor Threads property is available on
the Configurations&gt;configuration-name&gt;Network Config&gt;Transports&gt;tcp
page.</p>
</div>
<div class="paragraph">
<p><a id="abehk"></a><a id="GSPTG00065"></a><a id="thread-pool-settings"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_thread_pool_settings">Thread Pool Settings</h3>
<div class="paragraph">
<p>You can tune thread pool settings by following the instructions in
"<a href="../administration-guide/threadpools.html#GSADG00008">Administering Thread Pools</a>" in GlassFish Server Open
Source Edition Administration Guide. If using the Administration Console
Thread Pool settings are available on the
Configurations&gt;configuration-name&gt;Thread Pools&gt;thread-pool-name page.</p>
</div>
<div class="paragraph">
<p>The following thread pool settings can have significant effects on
GlassFish Server performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abefn">Max Thread Pool Size</a></p>
</li>
<li>
<p><a href="#abefo">Min Thread Pool Size</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abefn"></a><a id="GSPTG00197"></a><a id="max-thread-pool-size"></a></p>
</div>
<div class="sect3">
<h4 id="_max_thread_pool_size">Max Thread Pool Size</h4>
<div class="paragraph">
<p>The Max Thread Pool Size parameter specifies the maximum number of
simultaneous requests the server can handle. The default value is 5.
When the server has reached the limit or request threads, it defers
processing new requests until the number of active requests drops below
the maximum amount. Increasing this value will reduce HTTP response
latency times.</p>
</div>
<div class="paragraph">
<p>In practice, clients frequently connect to the server and then do not
complete their requests. In these cases, the server waits a length of
time specified by the Timeout parameter.</p>
</div>
<div class="paragraph">
<p>Also, some sites do heavyweight transactions that take minutes to
complete. Both of these factors add to the maximum simultaneous requests
that are required. If your site is processing many requests that take
many seconds, you might need to increase the number of maximum
simultaneous requests.</p>
</div>
<div class="paragraph">
<p>Adjust the thread count value based on your load and the length of time
for an average request. In general, increase this number if you have
idle CPU time and requests that are pending; decrease it if the CPU
becomes overloaded. If you have many HTTP 1.0 clients (or HTTP 1.1
clients that disconnect frequently), adjust the timeout value to reduce
the time a connection is kept open.</p>
</div>
<div class="paragraph">
<p>Suitable Request Max Thread Pool Size values range from 100 to 500,
depending on the load. If your system has extra CPU cycles, keep
incrementally increasing thread count and monitor performance after each
incremental increase. When performance saturates (stops improving), then
stop increasing thread count.</p>
</div>
<div class="paragraph">
<p><a id="abefo"></a><a id="GSPTG00198"></a><a id="min-thread-pool-size"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_min_thread_pool_size">Min Thread Pool Size</h4>
<div class="paragraph">
<p>The Min Thread Pool Size property specifies the minimum number of
threads the server initiates upon startup. The default value is 2. Min
Thread Pool Size represents a hard limit for the maximum number of
active threads that can run simultaneously, which can become a
bottleneck for performance.</p>
</div>
<div class="paragraph">
<p>Specifying the same value for minimum and maximum threads allows
GlassFish Server to use a slightly more optimized thread pool. This
configuration should be considered unless the load on the server varies
quite significantly.</p>
</div>
<div class="paragraph">
<p><a id="abegt"></a><a id="GSPTG00066"></a><a id="orb-settings"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_orb_settings">ORB Settings</h3>
<div class="paragraph">
<p>The GlassFish Server includes a high performance and scalable CORBA
Object Request Broker (ORB). The ORB is the foundation of the EJB
Container on the server.</p>
</div>
<div class="paragraph">
<p>For complete instructions on configuring ORB settings, refer to
"<a href="../administration-guide/orb.html#GSADG00018">Administering the Object Request Broker (ORB)</a>" in
GlassFish Server Open Source Edition Administration Guide. Also refer to
"<a href="../ha-administration-guide/rmi-iiop.html#GSHAG00013">RMI-IIOP Load Balancing and Failover</a>" in GlassFish
Server Open Source Edition High Availability Administration Guide. You
can also configure most ORB settings through the GlassFish Server
Administration Console by navigating to the
Configurations&gt;configuration-name&gt; ORB node and then following the
instructions in the Administration Console online help.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abegu">Overview</a></p>
</li>
<li>
<p><a href="#abegv">How a Client Connects to the ORB</a></p>
</li>
<li>
<p><a href="#abegw">Monitoring the ORB</a></p>
</li>
<li>
<p><a href="#abegz">Tuning the ORB</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abegu"></a><a id="GSPTG00199"></a><a id="overview"></a></p>
</div>
<div class="sect3">
<h4 id="_overview">Overview</h4>
<div class="paragraph">
<p>The ORB is primarily used by EJB components via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RMI/IIOP path from an application client (or rich client) using the
application client container.</p>
</li>
<li>
<p>RMI/IIOP path from another GlassFish Server instance ORB.</p>
</li>
<li>
<p>RMI/IIOP path from another vendor&#8217;s ORB.</p>
</li>
<li>
<p>In-process path from the Web Container or MDB (message driven beans)
container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a server instance makes a connection to another server instance
ORB, the first instance acts as a client ORB. SSL over IIOP uses a fast
optimized transport with high-performance native implementations of
cryptography algorithms.</p>
</div>
<div class="paragraph">
<p>It is important to remember that EJB local interfaces do not use the
ORB. Using a local interface passes all arguments by reference and does
not require copying any objects.</p>
</div>
<div class="paragraph">
<p><a id="abegv"></a><a id="GSPTG00200"></a><a id="how-a-client-connects-to-the-orb"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_how_a_client_connects_to_the_orb">How a Client Connects to the ORB</h4>
<div class="paragraph">
<p>A rich client Java program performs a new <code>initialContext()</code> call which
creates a client side ORB instance. This in turn creates a socket
connection to the GlassFish Server IIOP port. The reader thread is
started on the server ORB to service IIOP requests from this client.
Using the <code>initialContext</code>, the client code does a lookup of an EJB
deployed on the server. An IOR which is a remote reference to the
deployed EJB on the server is returned to the client. Using this object
reference, the client code invokes remote methods on the EJB.</p>
</div>
<div class="paragraph">
<p><code>InitialContext</code> lookup for the bean and the method invocations
translate the marshalling application request data in Java into IIOP
message(s) that are sent on the socket connection that was created
earlier on to the server ORB. The server then creates a response and
sends it back on the same connection. This data in the response is then
un-marshalled by the client ORB and given back to the client code for
processing. The Client ORB shuts down and closes the connection when the
rich client application exits.</p>
</div>
<div class="paragraph">
<p><a id="abegw"></a><a id="GSPTG00201"></a><a id="monitoring-the-orb"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_the_orb">Monitoring the ORB</h4>
<div class="paragraph">
<p>ORB statistics are disabled by default. To gather ORB statistics, enable
monitoring with the following <code>asadmin</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">set serverInstance.iiop-service.orb.system.monitoringEnabled=true
reconfig serverInstance</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using the Administration Console, you can enable ORB monitoring on
the Configurations&gt;configuration-name&gt;Monitoring page. To view ORB
monitoring statistics through the Administration Console, navigate to
the server (Admin Server) page and click the Monitor tab. Refer to the
Administration Console online help for complete instructions.</p>
</div>
<div class="paragraph">
<p>The following statistics are of particular interest when tuning the ORB:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abegx">Connection Statistics</a></p>
</li>
<li>
<p><a href="#abegy">Thread Pools</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abegx"></a><a id="GSPTG00136"></a><a id="connection-statistics"></a></p>
</div>
<div class="sect4">
<h5 id="_connection_statistics">Connection Statistics</h5>
<div class="paragraph">
<p>The following statistics are gathered on ORB connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>total-inbound-connections</code>: Total inbound connections to ORB.</p>
</li>
<li>
<p><code>total-outbound-connections</code>: Total outbound connections from ORB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the following command to get ORB connection statistics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin get --monitor
    serverInstance.iiop-service.orb.system.orb-connection.*</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="abegy"></a><a id="GSPTG00137"></a><a id="thread-pools"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_thread_pools">Thread Pools</h5>
<div class="paragraph">
<p>The following statistics are gathered on ORB thread pools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>thread-pool-size</code>: Number of threads in ORB thread pool.</p>
</li>
<li>
<p><code>waiting-thread-count</code>: Number of thread pool threads waiting for work
to arrive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the following command to display ORB thread pool statistics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin get --monitor
    serverInstance.iiop-service.orb.system.orb-thread-pool.*</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="abegz"></a><a id="GSPTG00202"></a><a id="tuning-the-orb"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_the_orb">Tuning the ORB</h4>
<div class="paragraph">
<p>Tune ORB performance by setting ORB parameters and ORB thread pool
parameters. You can often decrease response time by leveraging
load-balancing, multiple shared connections, thread pool and message
fragment size. You can improve scalability by load balancing between
multiple ORB servers from the client, and tuning the number of
connection between the client and the server.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeha">Tunable ORB Parameters</a></p>
</li>
<li>
<p><a href="#abehb">ORB Thread Pool Parameters</a></p>
</li>
<li>
<p><a href="#abehc">Client ORB Properties</a></p>
</li>
<li>
<p><a href="#abehg">Thread Pool Sizing</a></p>
</li>
<li>
<p><a href="#abehh">Examining IIOP Messages</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeha"></a><a id="GSPTG00138"></a><a id="tunable-orb-parameters"></a></p>
</div>
<div class="sect4">
<h5 id="_tunable_orb_parameters">Tunable ORB Parameters</h5>
<div class="paragraph">
<p>You can tune ORB parameters using the instructions in
"<a href="../administration-guide/orb.html#GSADG00018">Administering the Object Request Broker (ORB)</a>" in
GlassFish Server Open Source Edition Administration Guide. If using the
Administration Console, navigate to the
Configurations&gt;configuration-name&gt;ORB node and refer to the online help.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the tunable ORB parameters.</p>
</div>
<div class="paragraph">
<p><a id="sthref8"></a><a id="gacma"></a></p>
</div>
<div class="paragraph">
<p>Table 3-2 Tunable ORB Parameters</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 27%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">ORB Modules</th>
<th class="tableblock halign-left valign-top">Server Settings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMI/ IIOP from application client to application server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">communication
infrastructure, thread pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">steady-thread-pool-size,
max-thread-pool-size, idle-thread-timeout-in-seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMI/ IIOP from ORB to GlassFish Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">communication infrastructure,
thread pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">steady-thread-pool-size, max-thread-pool-size,
idle-thread-timeout-in-seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RMI/ IIOP from a vendor ORB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parts of communication infrastructure,
thread pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">steady-thread-pool-size, max-thread-pool-size,
idle-thread-timeout-in-seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In-process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thread pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">steady-thread-pool-size, max-thread-pool-size,
idle-thread-timeout-in-seconds</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="abehb"></a><a id="GSPTG00139"></a><a id="orb-thread-pool-parameters"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_orb_thread_pool_parameters">ORB Thread Pool Parameters</h5>
<div class="paragraph">
<p>The ORB thread pool contains a task queue and a pool of threads. Tasks
or jobs are inserted into the task queue and free threads pick tasks
from this queue for execution. Do not set a thread pool size such that
the task queue is always empty. It is normal for a large application&#8217;s
Max Pool Size to be ten times the size of the current task queue.</p>
</div>
<div class="paragraph">
<p>The GlassFish Server uses the ORB thread pool to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute every ORB request</p>
</li>
<li>
<p>Trim EJB pools and caches</p>
</li>
<li>
<p>Execute MDB requests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, even when one is not using ORB for remote-calls (via RMI/ IIOP),
set the size of the threadpool to facilitate cleaning up the EJB pools
and caches.</p>
</div>
<div class="paragraph">
<p>You can set ORB thread pool attributes using the instructions in
"<a href="../administration-guide/threadpools.html#GSADG00008">Administering Thread Pools</a>" in GlassFish Server Open
Source Edition Administration Guide. If using the Administration
Console, navigate to Configurations&gt;configuration-name&gt; Thread
Pools&gt;thread-pool-name, where thread-pool-name is the thread pool ID
selected for the ORB. Thread pools have the following attributes that
affect performance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimum Pool Size: The minimum number of threads in the ORB thread
pool. Set to the average number of threads needed at a steady (RMI/
IIOP) load.</p>
</li>
<li>
<p>Maximum Pool Size: The maximum number of threads in the ORB thread
pool.</p>
</li>
<li>
<p>Idle Timeout: Number of seconds to wait before removing an idle thread
from pool. Allows shrinking of the thread pool.</p>
</li>
<li>
<p>Number of Work Queues</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In particular, the maximum pool size is important to performance. For
more information, see <a href="#abehg">Thread Pool Sizing</a>.</p>
</div>
<div class="paragraph">
<p><a id="abehc"></a><a id="GSPTG00140"></a><a id="client-orb-properties"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_client_orb_properties">Client ORB Properties</h5>
<div class="paragraph">
<p>Specify the following properties as command-line arguments when
launching the client program. You do this by using the following syntax
when starting the Java VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">-Dproperty=value</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abehd">Controlling Connections Between Client and Server ORB</a></p>
</li>
<li>
<p><a href="#CEGDGBBG">Limiting the Maximum Number of Client Connections</a></p>
</li>
<li>
<p><a href="#abehf">Load Balancing</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abehd"></a><a id="GSPTG00025"></a><a id="controlling-connections-between-client-and-server-orb"></a></p>
</div>
<div class="paragraph">
<p>Controlling Connections Between Client and Server ORB</p>
</div>
<div class="paragraph">
<p>When using the default JDK ORB on the client, a connection is
established from the client ORB to the application server ORB every time
an initial context is created. To pool or share these connections when
they are opened from the same process by adding to the configuration on
the client ORB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">-Djava.naming.factory.initial=com.sun.enterprise.naming.SerialInitContextFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="CEGDGBBG"></a><a id="limiting-the-maximum-number-of-client-connections"></a></p>
</div>
<div class="paragraph">
<p>Limiting the Maximum Number of Client Connections</p>
</div>
<div class="paragraph">
<p>You can specify the total maximum number of client connections on all
ORB listener ports (TCP, SSL and SSL with mutual authentication). When
open client connections exceed the maximum value you specify, the ORB
rejects any new incoming client connections.</p>
</div>
<div class="paragraph">
<p>Set this value to support the expected number of simultaneous client
connections, but not to exceed the VM or system file descriptor limits.
If the value is set too high, the ORB will continue accepting new client
connections, resulting in a "too many open files" error if the VM runs
out of file descriptors.</p>
</div>
<div class="paragraph">
<p>To specify the maximum number of client connections, set the
<code>configs.config.``config-name.``iiop-service.orb.max-connections</code>
attribute to the number that you require:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin&gt; set configs.config.config-name.iiop-service.orb.max-connections=max-connections</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">config-name</dt>
<dd>
<p>The name of the configuration in which the IIOP service is defined.
For example, <code>server-config</code> is the name for the configuration of the
domain administration server (DAS).</p>
</dd>
<dt class="hdlist1">max-connections</dt>
<dd>
<p>An integer that specifies the maximum number of client connections.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For updates to this value to take effect, restart GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the maximum number of client
connections for the ORB in the DAS to <code>512</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin&gt; set configs.config.server-config.iiop-service.orb.max-connections=512
configs.config.server-config.iiop-service.orb.max-connections=512
Command set executed successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="abehf"></a><a id="GSPTG00026"></a><a id="load-balancing"></a></p>
</div>
<div class="paragraph">
<p>Load Balancing</p>
</div>
<div class="paragraph">
<p>For information on how to configure HTTP load balancing, see
"<a href="../ha-administration-guide/http-load-balancing.html#GSHAG00009">Configuring HTTP Load Balancing</a>" in GlassFish Server
Open Source Edition High Availability Administration Guide.</p>
</div>
<div class="paragraph">
<p>For information on how to configure RMI/IIOP for multiple application
server instances in a cluster, "<a href="../ha-administration-guide/rmi-iiop.html#GSHAG00013">RMI-IIOP Load Balancing
and Failover</a>" in GlassFish Server Open Source Edition High Availability
Administration Guide.</p>
</div>
<div class="paragraph">
<p>When tuning the client ORB for load-balancing and connections, consider
the number of connections opened on the server ORB. Start from a low
number of connections and then increase it to observe any performance
benefits. A connection to the server translates to an ORB thread reading
actively from the connection (these threads are not pooled, but exist
currently for the lifetime of the connection).</p>
</div>
<div class="paragraph">
<p><a id="abehg"></a><a id="GSPTG00141"></a><a id="thread-pool-sizing"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_thread_pool_sizing">Thread Pool Sizing</h5>
<div class="paragraph">
<p>After examining the number of inbound and outbound connections as
explained above, tune the size of the thread pool appropriately. This
can affect performance and response times significantly.</p>
</div>
<div class="paragraph">
<p>The size computation takes into account the number of client requests to
be processed concurrently, the resource (number of CPUs and amount of
memory) available on the machine and the response times required for
processing the client requests.</p>
</div>
<div class="paragraph">
<p>Setting the size to a very small value can affect the ability of the
server to process requests concurrently, thus affecting the response
times since requests will sit longer in the task queue. On the other
hand, having a large number of worker threads to service requests can
also be detrimental because they consume system resources, which
increases concurrency. This can mean that threads take longer to acquire
shared structures in the EJB container, thus affecting response times.</p>
</div>
<div class="paragraph">
<p>The worker thread pool is also used for the EJB container&#8217;s housekeeping
activity such as trimming the pools and caches. This activity needs to
be accounted for also when determining the size. Having too many ORB
worker threads is detrimental for performance since the server has to
maintain all these threads. The idle threads are destroyed after the
idle thread timeout period.</p>
</div>
<div class="paragraph">
<p><a id="abehh"></a><a id="GSPTG00142"></a><a id="examining-iiop-messages"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_examining_iiop_messages">Examining IIOP Messages</h5>
<div class="paragraph">
<p>It is sometimes useful to examine the IIOP messages passed by the
GlassFish Server. To make the server save IIOP messages to the
<code>server.log</code> file, set the JVM option <code>-Dcom.sun.CORBA.ORBDebug=giop</code>.
Use the same option on the client ORB.</p>
</div>
<div class="paragraph">
<p>The following is an example of IIOP messages saved to the server log.
Note: in the actual output, each line is preceded by the timestamp, such
as <code>[29/Aug/2002:22:41:43] INFO (27179): CORE3282: stdout</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"> ++++++++++++++++++++++++++++++
 Message(Thread[ORB Client-side Reader, conn to 192.18.80.118:1050,5,main]):
createFromStream: type is 4 &lt;
 MessageBase(Thread[ORB Client-side Reader, conn to 192.18.80.118:1050,5,main]):
Message GIOP version: 1.2
 MessageBase(Thread[ORB Client-side Reader, conn to 192.18.80.118:1050,5,main]):
ORB Max GIOP Version: 1.2
 Message(Thread[ORB Client-side Reader, conn to 192.18.80.118:1050,5,main]):
createFromStream: message construction complete.
 com.sun.corba.ee.internal.iiop.MessageMediator
(Thread[ORB Client-side Reader, conn to 192.18.80.118:1050,5,main]): Received message:
 ----- Input Buffer -----
 Current index: 0
 Total length : 340
 47 49 4f 50 01 02 00 04 0 0 00 01 48 00 00 00 05 GIOP.......H....</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>The flag <code>-Dcom.sun.CORBA.ORBdebug=giop</code> generates many debug messages
in the logs. This is used only when you suspect message fragmentation.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this sample output above, the <code>createFromStream</code> type is shown as
<code>4</code>. This implies that the message is a fragment of a bigger message. To
avoid fragmented messages, increase the fragment size. Larger fragments
mean that messages are sent as one unit and not as fragments, saving the
overhead of multiple messages and corresponding processing at the
receiving end to piece the messages together.</p>
</div>
<div class="paragraph">
<p>If most messages being sent in the application are fragmented,
increasing the fragment size is likely to improve efficiency. On the
other hand, if only a few messages are fragmented, it might be more
efficient to have a lower fragment size that requires smaller buffers
for writing messages.</p>
</div>
<div class="paragraph">
<p><a id="abehp"></a><a id="GSPTG00067"></a><a id="resource-settings"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_settings">Resource Settings</h3>
<div class="paragraph">
<p>Tuning JDBC and connector resources can significantly improve GlassFish
Server performance.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abehq">JDBC Connection Pool Settings</a></p>
</li>
<li>
<p><a href="#abehy">Connector Connection Pool Settings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abehq"></a><a id="GSPTG00203"></a><a id="jdbc-connection-pool-settings"></a></p>
</div>
<div class="sect3">
<h4 id="_jdbc_connection_pool_settings">JDBC Connection Pool Settings</h4>
<div class="paragraph">
<p>For optimum performance of database-intensive applications, tune the
JDBC Connection Pools managed by the GlassFish Server. These connection
pools maintain numerous live database connections that can be reused to
reduce the overhead of opening and closing database connections. This
section describes how to tune JDBC Connection Pools to improve
performance.</p>
</div>
<div class="paragraph">
<p>J2EE applications use JDBC Resources to obtain connections that are
maintained by the JDBC Connection Pool. More than one JDBC Resource is
allowed to refer to the same JDBC Connection Pool. In such a case, the
physical connection pool is shared by all the resources.</p>
</div>
<div class="paragraph">
<p>Refer to "<a href="../administration-guide/jdbc.html#GSADG00015">Administering Database Connectivity</a>" in
GlassFish Server Open Source Edition Administration Guide for more
information about managing JDBC connection pools.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abehr">Monitoring JDBC Connection Pools</a></p>
</li>
<li>
<p><a href="#abehs">Tuning JDBC Connection Pools</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abehr"></a><a id="GSPTG00143"></a><a id="monitoring-jdbc-connection-pools"></a></p>
</div>
<div class="sect4">
<h5 id="_monitoring_jdbc_connection_pools">Monitoring JDBC Connection Pools</h5>
<div class="paragraph">
<p>Statistics-gathering is disabled by default for JDBC Connection Pools.
Refer to for instructions on enabling JDBC monitoring in
"<a href="../administration-guide/monitoring.html#GSADG00011">Administering the Monitoring Service</a>" in GlassFish
Server Open Source Edition Administration Guide. If using the
Administration Console, JDBC monitoring can be enabled on the
Configurations&gt;configuration-name&gt;Monitoring page.</p>
</div>
<div class="paragraph">
<p>The following attributes are monitored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>numConnFailedValidation (count)</code> Number of connections that failed
validation.</p>
</li>
<li>
<p><code>numConnUsed (range)</code> Number of connections that have been used.</p>
</li>
<li>
<p><code>numConnFree (count)</code> Number of free connections in the pool.</p>
</li>
<li>
<p><code>numConnTimedOut (bounded range)</code> Number of connections in the pool
that have timed out.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get JDBC monitoring statistics, use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin get --monitor=true
serverInstance.resources.jdbc-connection-pool.*asadmin get
--monitor=true serverInstance.resources.jdbc-connection-pool. poolName.* *</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view JDBC monitoring statistics through the Administration Console,
navigate to the server (Admin Server) page and click the Monitor tab.
Refer to the Administration Console online help for complete
instructions.</p>
</div>
<div class="paragraph">
<p><a id="abehs"></a><a id="GSPTG00144"></a><a id="tuning-jdbc-connection-pools"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_tuning_jdbc_connection_pools">Tuning JDBC Connection Pools</h5>
<div class="paragraph">
<p>Refer to "<a href="../administration-guide/jdbc.html#GSADG00015">Administering Database Connectivity</a>" in
GlassFish Server Open Source Edition Administration Guide for
instructions on configuring JDBC connection pools. If using the
GlassFish Server Administration Console by navigating to the
Resources&gt;JDBC&gt;JDBC Connection Pools&gt;jdbc-pool-name page and then
clicking the desired tab.</p>
</div>
<div class="paragraph">
<p>The following JDBC properites affect GlassFish Server performance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#abeht">Pool Size Settings</a></p>
</li>
<li>
<p><a href="#abehu">Timeout Settings</a></p>
</li>
<li>
<p><a href="#abehv">Isolation Level Settings</a></p>
</li>
<li>
<p><a href="#abehw">Connection Validation Settings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abeht"></a><a id="GSPTG00027"></a><a id="pool-size-settings"></a></p>
</div>
<div class="paragraph">
<p>Pool Size Settings</p>
</div>
<div class="paragraph">
<p>Pool Size settings can be configured in the Pool Settings section on the
General tab in the Edit JDBC Connection Pool page.</p>
</div>
<div class="paragraph">
<p>The following settings control the size of the connection pool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initial and Mimimum Pool Size: Size of the pool when created, and its
minimum allowable size.</p>
</li>
<li>
<p>Maximum Pool Size: Upper limit of size of the pool.</p>
</li>
<li>
<p>Pool Resize Quantity: Number of connections to be removed when the
idle timeout expires. Connections that have idled for longer than the
timeout are candidates for removal. When the pool size reaches the
initial and minimum pool size, removal of connections stops.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table summarizes advantages and disadvantages to consider
when sizing connection pools.</p>
</div>
<div class="paragraph">
<p><a id="sthref9"></a><a id="gacmi"></a></p>
</div>
<div class="paragraph">
<p>Table 3-3 Connection Pool Sizing</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 21%;">
<col style="width: 38%;">
<col style="width: 41%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Connection Pool</th>
<th class="tableblock halign-left valign-top">Advantages</th>
<th class="tableblock halign-left valign-top">Disadvantages</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small Connection pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Faster access on the connection table.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>May not have enough connections to satisfy requests.</p>
</div>
<div class="paragraph">
<p>Requests may spend more time in the queue.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large Connection pool</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>More connections to fulfill requests.</p>
</div>
<div class="paragraph">
<p>Requests will spend less (or no) time in the queue</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slower access on the connection table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="abehu"></a><a id="GSPTG00028"></a><a id="timeout-settings"></a></p>
</div>
<div class="paragraph">
<p>Timeout Settings</p>
</div>
<div class="paragraph">
<p>The following JDBC timeout settings can be configured on the in the Pool
Settings section on the General tab in the Edit JDBC Connection Pool
page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Max Wait Time: Amount of time the caller (the code requesting a
connection) will wait before getting a connection timeout. The default
is 60 seconds. A value of zero forces caller to wait indefinitely.<br>
To improve performance set Max Wait Time to zero (0). This essentially
blocks the caller thread until a connection becomes available. Also,
this allows the server to alleviate the task of tracking the elapsed
wait time for each request and increases performance.</p>
</li>
<li>
<p>Idle Timeout: Maximum time in seconds that a connection can remain
idle in the pool. After this time, the pool can close this connection.
This property does not control connection timeouts on the database
server.<br>
Keep this timeout shorter than the database server timeout (if such
timeouts are configured on the database), to prevent accumulation of
unusable connection in GlassFish Server.<br>
For best performance, set Idle Timeout to zero (0) seconds, so that idle
connections will not be removed. This ensures that there is normally no
penalty in creating new connections and disables the idle monitor
thread. However, there is a risk that the database server will reset a
connection that is unused for too long.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abehv"></a><a id="GSPTG00029"></a><a id="isolation-level-settings"></a></p>
</div>
<div class="paragraph">
<p>Isolation Level Settings</p>
</div>
<div class="paragraph">
<p>The following JDBC Isolation Level settings can be configured in the
Transaction section on the General tab in the Edit JDBC Connection Pool
page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transaction Isolation: Specifies the transaction isolation level of
the pooled database connections. If this parameter is unspecified, the
pool uses the default isolation level provided by the JDBC Driver.</p>
</li>
<li>
<p>Isolation Level Guaranteed: Guarantees that every connection obtained
from the pool has the isolation specified for the Transaction Isolation
level. Applicable only when the Transaction Isolation level is
specified. The default value is Guaranteed.<br>
This setting can have some performance impact on some JDBC drivers. Set
to false when certain that the application does not change the isolation
level before returning the connection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Avoid specifying the Transaction Isolation level. If that is not
possible, consider disabling the Isolation Level Guaranteed option and
then make sure applications do not programmatically alter the
connections; isolation level.</p>
</div>
<div class="paragraph">
<p>If you must specify a Transaction Isolation level, specify the
best-performing level possible. The isolation levels listed from best
performance to worst are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>READ_UNCOMMITTED</code></p>
</li>
<li>
<p><code>READ_COMMITTED</code></p>
</li>
<li>
<p><code>REPEATABLE_READ</code></p>
</li>
<li>
<p><code>SERIALIZABLE</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Choose the isolation level that provides the best performance, yet still
meets the concurrency and consistency needs of the application.</p>
</div>
<div class="paragraph">
<p><a id="abehw"></a><a id="GSPTG00030"></a><a id="connection-validation-settings"></a></p>
</div>
<div class="paragraph">
<p>Connection Validation Settings</p>
</div>
<div class="paragraph">
<p>JDBC Connection Validation settings can be configured in the Connection
Validation section on the Advanced tab in the Edit JDBC Connection Pool
page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection Validation Required: If enabled, the pool validates
connections (checks to find out if they are usable) before providing
them to an application.<br>
If possible, keep this option disabled. Requiring connection validation
forces the server to apply the validation algorithm every time the pool
returns a connection, which adds overhead to the latency of
<code>getConnection()</code>. If the database connectivity is reliable, you can
omit validation.</p>
</li>
<li>
<p>Validation Method: Specifies the type of connection validation to
perform. Must be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p><code>auto-commit</code>: Attempt to perform an auto-commit on the connection.</p>
</li>
<li>
<p><code>metadata</code>: Attempt to get metadata from the connection.</p>
</li>
<li>
<p><code>table</code>: Performing the query on a specified table. If this option is
selected, Table Name must also be set. Choosing this option may be
necessary if the JDBC driver caches calls to <code>setAutoCommit()</code> and
<code>getMetaData()</code>.</p>
</li>
<li>
<p><code>custom-validation</code>: Define a custom validation method.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Table Name: Name of the table to query when the Validation Method is
set to <code>table</code>.</p>
</li>
<li>
<p>Close All Connections On Any Failure: Specify whether all connections
in the pool should be closed if a single validation check fails. This
option is disabled by default. One attempt will be made to re-establish
failed connections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="abehy"></a><a id="GSPTG00204"></a><a id="connector-connection-pool-settings"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_connector_connection_pool_settings">Connector Connection Pool Settings</h4>
<div class="paragraph">
<p>From a performance standpoint, connector connection pools are similar to
JDBC connection pools. Follow all the recommendations in the previous
section, <a href="#abehs">Tuning JDBC Connection Pools</a>.</p>
</div>
<div class="paragraph">
<p><a id="abehz"></a><a id="GSPTG00145"></a><a id="transaction-support"></a></p>
</div>
<div class="sect4">
<h5 id="_transaction_support">Transaction Support</h5>
<div class="paragraph">
<p>You may be able to improve performance by overriding the default
transaction support specified for each connector connection pool.</p>
</div>
<div class="paragraph">
<p>For example, consider a case where an Enterprise Information System
(EIS) has a connection factory that supports local transactions with
better performance than global transactions. If a resource from this EIS
needs to be mixed with a resource coming from another resource manager,
the default behavior forces the use of XA transactions, leading to lower
performance. However, by changing the EIS&#8217;s connector connection pool to
use LocalTransaction transaction support and leveraging the Last Agent
Optimization feature previously described, you could leverage the
better-performing EIS LocalTransaction implementation. For more
information on LAO, see <a href="tuning-apps.html#abecq">Configure JDBC
Resources as One-Phase Commit Resources</a>.</p>
</div>
<div class="paragraph">
<p>You can specify transaction support when you create or edit a connector
connection pool.</p>
</div>
<div class="paragraph">
<p>Also set transaction support using <code>asadmin</code>. For example, the following
<code>asadmin</code> command could be used to create a connector connection pool
<code>TESTPOOL</code> with <code>transaction-support</code> set to <code>LOCAL</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">asadmin&gt; create-connector-connection-pool --raname jdbcra
--connectiondefinition javax.sql.DataSource
-transactionsupport LocalTransaction
TESTPOOL</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gkxvd"></a><a id="GSPTG00068"></a><a id="load-balancer-settings"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_load_balancer_settings">Load Balancer Settings</h3>
<div class="paragraph">
<p>GlassFish Server Open Source Edition is compatible with the Apache HTTP
server <code>mod_jk</code> module for load balancing.</p>
</div>
<div class="paragraph">
<p>GlassFish Server load balancing configurations can vary widely depending
on the needs of your enterprise and are beyond the scope of this
Performance Tuning Guide. For complete information about configuring
load balancing in GlassFish Server, refer to the following
documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"<a href="../ha-administration-guide/http-load-balancing.html#GSHAG00009">Configuring HTTP Load Balancing</a>" in GlassFish
Server Open Source Edition High Availability Administration Guide</p>
</li>
<li>
<p>"<a href="../ha-administration-guide/rmi-iiop.html#GSHAG00013">RMI-IIOP Load Balancing and Failover</a>" in GlassFish
Server Open Source Edition High Availability Administration Guide</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<hr />

<table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>		
		<td align="left">
		<a href="tuning-apps.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="tuning-java.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>

<span id="copyright">
        <img src="/img/eclipse_foundation_logo_tiny.png" height="20px" alt="Eclipse Foundation Logo" align="top"/>&nbsp;            
        <span >Copyright&nbsp;&copy;&nbsp;2019,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.</span>
</span>
</body>
</html>